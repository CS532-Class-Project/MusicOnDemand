
<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<!-- Load d3.js -->
<script src="js/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>
<script>

// 创建SVG区域
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", 600)
    .attr("height", 600)
  .append("g")
    .attr("transform", "translate(240,240)")


// 创建矩阵、城市（或群体）名称、色彩数据
var matrix = [
  [0,  5871, 8916, 2868],
  [ 1951, 0, 2060, 6171],
  [ 8010, 16145, 0, 8045],
  [ 1013,   990,  940, 0]
];
var cities=[
{"name": "Las Cruces"},
{"name": "Socorro"},
{"name": "Albuquerque"},
{"name": "Taos"}
];
// 4 groups, so create a vector of 4 colors
var colors = [ "#440154ff", "#31668dff", "#37b578ff", "#fde725ff"]

// 使用矩阵和 d3.chord()，得到画圆弧和发带所需的数据
var res = d3.chord()
    .padAngle(0.05)
    .sortSubgroups(d3.descending)
    (matrix);

// 在外圈添加各群体
svg
  .datum(res)
  .append("g")
  .selectAll("g")
  .data(function(d) { return d.groups; })
   .enter()
  .append("g")
  .append("path")
     .style("fill", function(d,i){ return colors[i] })
    .style("stroke", "black")
    .attr("d", d3.arc()
      .innerRadius(200)
      .outerRadius(210)

    ) ;
	
// 在更外圈添加各群体名称文本	
var arcs = new Array();
var paths = new Array();
for (var i = 0; i < cities.length; i++){
    arcs[i]= d3.arc()
    .innerRadius(220)
    .outerRadius(230)
    .startAngle(res.groups[i]["startAngle"])
    .endAngle(res.groups[i]["endAngle"]);
	paths[i] = svg.append("path")
    .attr("d", arcs[i])
    .attr("id", "path"+i)
    .attr("fill","#FFFFFF");
	var text = svg.append("text")
    .attr("x", 6)
    .attr("dy", 15);
	
text.append("textPath")
     .attr("stroke","black")
	  //  .attr("text-anchor", "middle")
  //.attr("startOffset", "50%");
	  .attr("startOffset","0%")
    .attr("xlink:href","#path"+i)
    .text(cities[i]["name"]); 
}	


// 添加群体之间的联系
svg
  .datum(res)
  .append("g")
  .selectAll("path")
  .data(function(d) { return d; })
  .enter()
  .append("path")
    .attr("d", d3.ribbon()
      .radius(200)
    )
	
    .style("fill", function(d){ return(colors[d.source.index]) }) // colors depend on the source group. Change to target otherwise.
    .style("stroke", "black");

</script>
</html>